"use strict";function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module?t(exports,require("stream"),require("http"),require("url"),require("https"),require("zlib")):"function"==typeof define&&define.amd?define(["exports","stream","http","url","https","zlib"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Corinth={},e.Stream,e.http,e.Url,e.https,e.zlib)}(void 0,function(e,t,r,n,o,i){function u(e){return e&&"object"===_typeof2(e)&&"default"in e?e:{default:e}}var b=u(t),a=u(r),n=u(n),v=u(o),m=u(i);var s,c=b.default.Readable,l=Symbol("buffer"),f=Symbol("type"),p=function(){function s(){_classCallCheck(this,s),this[f]="";var e=arguments[0],t=arguments[1],r=[];if(e)for(var n=e,o=Number(n.length),i=0;i<o;i++){var u=n[i],a=void 0;(a=u instanceof Buffer?u:ArrayBuffer.isView(u)?Buffer.from(u.buffer,u.byteOffset,u.byteLength):u instanceof ArrayBuffer?Buffer.from(u):u instanceof s?u[l]:Buffer.from("string"==typeof u?u:String(u))).length,r.push(a)}this[l]=Buffer.concat(r);t=t&&void 0!==t.type&&String(t.type).toLowerCase();t&&!/[^\u0020-\u007E]/.test(t)&&(this[f]=t)}return _createClass(s,[{key:"size",get:function(){return this[l].length}},{key:"type",get:function(){return this[f]}},{key:"text",value:function(){return Promise.resolve(this[l].toString())}},{key:"arrayBuffer",value:function(){var e=this[l],e=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(e)}},{key:"stream",value:function(){var e=new c;return e._read=function(){},e.push(this[l]),e.push(null),e}},{key:"toString",value:function(){return"[object Blob]"}},{key:"slice",value:function(){var e=this.size,t=arguments[0],r=arguments[1],t=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),e=void 0===r?e:r<0?Math.max(e+r,0):Math.min(r,e),e=Math.max(e-t,0),t=this[l].slice(t,t+e),e=new s([],{type:arguments[2]});return e[l]=t,e}}]),s}();function g(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(p.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(p.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),((g.prototype=Object.create(Error.prototype)).constructor=g).prototype.name="FetchError";try{s=require("encoding").convert}catch(e){}var h=Symbol("Body internals"),d=b.default.PassThrough;function y(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=r.size,n=void 0===n?0:n,r=r.timeout,r=void 0===r?0:r;null==e?e=null:_(e)?e=Buffer.from(e.toString()):k(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof b.default||(e=Buffer.from(String(e)))),this[h]={body:e,disturbed:!1,error:null},this.size=n,this.timeout=r,e instanceof b.default&&e.on("error",function(e){e="AbortError"===e.name?e:new g("Invalid response body while trying to fetch ".concat(t.url,": ").concat(e.message),"system",e);t[h].error=e})}function w(){var n=this;if(this[h].disturbed)return y.Promise.reject(new TypeError("body used already for: ".concat(this.url)));if(this[h].disturbed=!0,this[h].error)return y.Promise.reject(this[h].error);var o=this.body;if(null===o)return y.Promise.resolve(Buffer.alloc(0));if(k(o)&&(o=o.stream()),Buffer.isBuffer(o))return y.Promise.resolve(o);if(!(o instanceof b.default))return y.Promise.resolve(Buffer.alloc(0));var i=[],u=0,a=!1;return new y.Promise(function(e,t){var r;n.timeout&&(r=setTimeout(function(){a=!0,t(new g("Response timeout while trying to fetch ".concat(n.url," (over ").concat(n.timeout,"ms)"),"body-timeout"))},n.timeout)),o.on("error",function(e){"AbortError"===e.name?(a=!0,t(e)):t(new g("Invalid response body while trying to fetch ".concat(n.url,": ").concat(e.message),"system",e))}),o.on("data",function(e){if(!a&&null!==e){if(n.size&&u+e.length>n.size)return a=!0,void t(new g("content size at ".concat(n.url," over limit: ").concat(n.size),"max-size"));u+=e.length,i.push(e)}}),o.on("end",function(){if(!a){clearTimeout(r);try{e(Buffer.concat(i,u))}catch(e){t(new g("Could not create Buffer from response body for ".concat(n.url,": ").concat(e.message),"system",e))}}})})}function _(e){return"object"===_typeof2(e)&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function k(e){return"object"===_typeof2(e)&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function T(e){var t,r,n=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return n instanceof b.default&&"function"!=typeof n.getBoundary&&(t=new d,r=new d,n.pipe(t),n.pipe(r),e[h].body=t,n=r),n}function S(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":_(e)?"application/x-www-form-urlencoded;charset=UTF-8":k(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?"multipart/form-data;boundary=".concat(e.getBoundary()):e instanceof b.default?null:"text/plain;charset=UTF-8"}function P(e){e=e.body;return null===e?0:k(e)?e.size:Buffer.isBuffer(e)?e.length:e&&"function"==typeof e.getLengthSync&&(e._lengthRetrievers&&0==e._lengthRetrievers.length||e.hasKnownLength&&e.hasKnownLength())?e.getLengthSync():null}y.prototype={get body(){return this[h].body},get bodyUsed(){return this[h].disturbed},arrayBuffer:function(){return w.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob:function(){var t=this.headers&&this.headers.get("content-type")||"";return w.call(this).then(function(e){return Object.assign(new p([],{type:t.toLowerCase()}),_defineProperty({},l,e))})},json:function(){var t=this;return w.call(this).then(function(e){try{return JSON.parse(e.toString())}catch(e){return y.Promise.reject(new g("invalid json response body at ".concat(t.url," reason: ").concat(e.message),"invalid-json"))}})},text:function(){return w.call(this).then(function(e){return e.toString()})},buffer:function(){return w.call(this)},textConverted:function(){var t=this;return w.call(this).then(function(e){return function(e,t){if("function"!=typeof s)throw new Error("The package `encoding` must be installed to use the textConverted() function");var r,n=t.get("content-type"),t="utf-8";n&&(r=/charset=([^;]*)/i.exec(n));n=e.slice(0,1024).toString(),!r&&n&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(n));!r&&n&&((r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(n))||(r=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(n))&&r.pop(),r=r&&/charset=(.*)/i.exec(r.pop()));!r&&n&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(n));r&&("gb2312"!==(t=r.pop())&&"gbk"!==t||(t="gb18030"));return s(e,"UTF-8",t).toString()}(e,t.headers)})}},Object.defineProperties(y.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),y.mixIn=function(e){var t,r=_createForOfIteratorHelper(Object.getOwnPropertyNames(y.prototype));try{for(r.s();!(t=r.n()).done;){var n,o=t.value;o in e||(n=Object.getOwnPropertyDescriptor(y.prototype,o),Object.defineProperty(e,o,n))}}catch(e){r.e(e)}finally{r.f()}},y.Promise=global.Promise;var O=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,x=/[^\t\x20-\x7e\x80-\xff]/;function j(e){if(e="".concat(e),O.test(e)||""===e)throw new TypeError("".concat(e," is not a legal HTTP header name"))}function E(e){if(e="".concat(e),x.test(e))throw new TypeError("".concat(e," is not a legal HTTP header value"))}function C(e,t){for(var r in t=t.toLowerCase(),e)if(r.toLowerCase()===t)return r}var A=Symbol("map"),B=function(){function w(){_classCallCheck(this,w);var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;if(this[A]=Object.create(null),e instanceof w)for(var t=e.raw(),r=0,n=Object.keys(t);r<n.length;r++){var o,i=n[r],u=_createForOfIteratorHelper(t[i]);try{for(u.s();!(o=u.n()).done;){var a=o.value;this.append(i,a)}}catch(e){u.e(e)}finally{u.f()}}else if(null!=e){if("object"!==_typeof2(e))throw new TypeError("Provided initializer must be an object");var s=e[Symbol.iterator];if(null!=s){if("function"!=typeof s)throw new TypeError("Header pairs must be iterable");var c,l=[],f=_createForOfIteratorHelper(e);try{for(f.s();!(c=f.n()).done;){var p=c.value;if("object"!==_typeof2(p)||"function"!=typeof p[Symbol.iterator])throw new TypeError("Each header pair must be iterable");l.push(Array.from(p))}}catch(e){f.e(e)}finally{f.f()}for(var h=0,d=l;h<d.length;h++){var y=d[h];if(2!==y.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(y[0],y[1])}}else for(var b=0,v=Object.keys(e);b<v.length;b++){var m=v[b],g=e[m];this.append(m,g)}}}return _createClass(w,[{key:"get",value:function(e){j(e="".concat(e));e=C(this[A],e);return void 0===e?null:this[A][e].join(", ")}},{key:"forEach",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,r=q(this),n=0;n<r.length;){var o=r[n],i=o[0],o=o[1];e.call(t,o,i,this),r=q(this),n++}}},{key:"set",value:function(e,t){e="".concat(e),t="".concat(t),j(e),E(t);var r=C(this[A],e);this[A][void 0!==r?r:e]=[t]}},{key:"append",value:function(e,t){e="".concat(e),t="".concat(t),j(e),E(t);var r=C(this[A],e);void 0!==r?this[A][r].push(t):this[A][e]=[t]}},{key:"has",value:function(e){return j(e="".concat(e)),void 0!==C(this[A],e)}},{key:"delete",value:function(e){j(e="".concat(e));e=C(this[A],e);void 0!==e&&delete this[A][e]}},{key:"raw",value:function(){return this[A]}},{key:"keys",value:function(){return z(this,"key")}},{key:"values",value:function(){return z(this,"value")}},{key:Symbol.iterator,value:function(){return z(this,"key+value")}}]),w}();function q(t,e){e=1<arguments.length&&void 0!==e?e:"key+value";return Object.keys(t[A]).sort().map("key"===e?function(e){return e.toLowerCase()}:"value"===e?function(e){return t[A][e].join(", ")}:function(e){return[e.toLowerCase(),t[A][e].join(", ")]})}B.prototype.entries=B.prototype[Symbol.iterator],Object.defineProperty(B.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(B.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});var H=Symbol("internal");function z(e,t){var r=Object.create(L);return r[H]={target:e,kind:t,index:0},r}var L=Object.setPrototypeOf({next:function(){if(!this||Object.getPrototypeOf(this)!==L)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[H],t=e.target,r=e.kind,e=e.index,r=q(t,r);return r.length<=e?{value:void 0,done:!0}:(this[H].index=e+1,{value:r[e],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(L,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});var U=Symbol("Response internals"),R=a.default.STATUS_CODES,I=function(){function o(){_classCallCheck(this,o);var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};y.call(this,e,t);var r=t.status||200,n=new B(t.headers);null==e||n.has("Content-Type")||(e=S(e))&&n.append("Content-Type",e),this[U]={url:t.url,status:r,statusText:t.statusText||R[r],headers:n,counter:t.counter}}return _createClass(o,[{key:"url",get:function(){return this[U].url||""}},{key:"status",get:function(){return this[U].status}},{key:"ok",get:function(){return 200<=this[U].status&&this[U].status<300}},{key:"redirected",get:function(){return 0<this[U].counter}},{key:"statusText",get:function(){return this[U].statusText}},{key:"headers",get:function(){return this[U].headers}},{key:"clone",value:function(){return new o(T(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}]),o}();y.mixIn(I.prototype),Object.defineProperties(I.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(I.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});var F=Symbol("Request internals"),M=n.default.parse,D=n.default.format,G="destroy"in b.default.Readable.prototype;function N(e){return"object"===_typeof2(e)&&"object"===_typeof2(e[F])}var $=function(){function a(e){_classCallCheck(this,a);var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};N(e)?t=M(e.url):(t=e&&e.href?M(e.href):M("".concat(e)),e={});var n=(n=r.method||e.method||"GET").toUpperCase();if((null!=r.body||N(e)&&null!==e.body)&&("GET"===n||"HEAD"===n))throw new TypeError("Request with GET/HEAD method cannot have body");var o=null!=r.body?r.body:N(e)&&null!==e.body?T(e):null;y.call(this,o,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});var i=new B(r.headers||e.headers||{});null==o||i.has("Content-Type")||(u=S(o))&&i.append("Content-Type",u);var u,o=N(e)?e.signal:null;if(null!=(o="signal"in r?r.signal:o)&&(!(u=(u=o)&&"object"===_typeof2(u)&&Object.getPrototypeOf(u))||"AbortSignal"!==u.constructor.name))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[F]={method:n,redirect:r.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:o},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}return _createClass(a,[{key:"method",get:function(){return this[F].method}},{key:"url",get:function(){return D(this[F].parsedURL)}},{key:"headers",get:function(){return this[F].headers}},{key:"redirect",get:function(){return this[F].redirect}},{key:"signal",get:function(){return this[F].signal}},{key:"clone",value:function(){return new a(this)}}]),a}();function J(e){var t=e[F].parsedURL,r=new B(e[F].headers);if(r.has("Accept")||r.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof b.default.Readable&&!G)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");var n,o=null;null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(o="0"),null==e.body||"number"==typeof(n=P(e))&&(o=String(n)),o&&r.set("Content-Length",o),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");o=e.agent;return"function"==typeof o&&(o=o(t)),r.has("Connection")||o||r.set("Connection","close"),Object.assign({},t,{method:e.method,headers:(e=r,r=Object.assign({__proto__:null},e[A]),void 0!==(e=C(e[A],"Host"))&&(r[e]=r[e][0]),r),agent:o})}function V(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}y.mixIn($.prototype),Object.defineProperty($.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties($.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),((V.prototype=Object.create(Error.prototype)).constructor=V).prototype.name="AbortError";var Q=b.default.PassThrough,Z=n.default.resolve;function K(o,i){if(!K.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return y.Promise=K.Promise,new K.Promise(function(s,c){function e(){var e=new V("The user aborted a request.");c(e),p.body&&p.body instanceof b.default.Readable&&p.body.destroy(e),d&&d.body&&d.body.emit("error",e)}var l,t,f,p=new $(o,i),r=J(p),n=("https:"===r.protocol?v:a).default.request,h=p.signal,d=null;function y(){t.abort(),h&&h.removeEventListener("abort",l),clearTimeout(f)}h&&h.aborted?e():(l=function(){e(),y()},t=n(r),h&&h.addEventListener("abort",l),p.timeout&&t.once("socket",function(e){f=setTimeout(function(){c(new g("network timeout at: ".concat(p.url),"request-timeout")),y()},p.timeout)}),t.on("error",function(e){c(new g("request to ".concat(p.url," failed, reason: ").concat(e.message),"system",e)),y()}),t.on("response",function(e){clearTimeout(f);var t=function(e){for(var t=new B,r=0,n=Object.keys(e);r<n.length;r++){var o=n[r];if(!O.test(o))if(Array.isArray(e[o])){var i,u=_createForOfIteratorHelper(e[o]);try{for(u.s();!(i=u.n()).done;){var a=i.value;x.test(a)||(void 0===t[A][o]?t[A][o]=[a]:t[A][o].push(a))}}catch(e){u.e(e)}finally{u.f()}}else x.test(e[o])||(t[A][o]=[e[o]])}return t}(e.headers);if(K.isRedirect(e.statusCode)){var r=t.get("Location"),n=null===r?null:Z(p.url,r);switch(p.redirect){case"error":return c(new g("uri requested responds with a redirect, redirect mode is set to error: ".concat(p.url),"no-redirect")),void y();case"manual":if(null!==n)try{t.set("Location",n)}catch(e){c(e)}break;case"follow":if(null===n)break;if(p.counter>=p.follow)return c(new g("maximum redirect reached at: ".concat(p.url),"max-redirect")),void y();var o={headers:new B(p.headers),follow:p.follow,counter:p.counter+1,agent:p.agent,compress:p.compress,method:p.method,body:p.body,signal:p.signal,timeout:p.timeout,size:p.size};return 303!==e.statusCode&&p.body&&null===P(p)?(c(new g("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void y()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==p.method)||(o.method="GET",o.body=void 0,o.headers.delete("content-length")),s(K(new $(n,o))),void y())}}e.once("end",function(){h&&h.removeEventListener("abort",l)});var i=e.pipe(new Q),u={url:p.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:p.size,timeout:p.timeout,counter:p.counter},a=t.get("Content-Encoding");if(!p.compress||"HEAD"===p.method||null===a||204===e.statusCode||304===e.statusCode)return d=new I(i,u),void s(d);r={flush:m.default.Z_SYNC_FLUSH,finishFlush:m.default.Z_SYNC_FLUSH};if("gzip"==a||"x-gzip"==a)return i=i.pipe(m.default.createGunzip(r)),d=new I(i,u),void s(d);if("deflate"!=a&&"x-deflate"!=a){if("br"==a&&"function"==typeof m.default.createBrotliDecompress)return i=i.pipe(m.default.createBrotliDecompress()),d=new I(i,u),void s(d);d=new I(i,u),s(d)}else e.pipe(new Q).once("data",function(e){i=8==(15&e[0])?i.pipe(m.default.createInflate()):i.pipe(m.default.createInflateRaw()),d=new I(i,u),s(d)})}),n=t,null===(r=(r=p).body)?n.end():k(r)?r.stream().pipe(n):Buffer.isBuffer(r)?(n.write(r),n.end()):r.pipe(n))})}K.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},K.Promise=global.Promise;var W,Y,X,ee,te,re=(W=Object.freeze({__proto__:null,default:K,Headers:B,Request:$,Response:I,FetchError:g}))&&W.default||W,ne=(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)})(e)}var r,n;r=void 0,n=function(e){var n,t,r=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=(r(i,t=Error),i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.isHaxanError=!0,e}function u(e){return e&&!0===e.isHaxanError}var a,h=(r(s,a=o),s);function s(){var e=a.call(this)||this;return e.isTimeout=!0,e}var c,d=(r(l,c=o),l);function l(e){var t=c.call(this)||this;return t.isRejection=!0,t.response=e,t}var f,y,b,v=(r(p,f=o),p);function p(){var e=f.call(this)||this;return e.isAbort=!0,e}(r=y={}).Auto="auto",r.Json="json",r.Text="text",r.Stream="stream",(r=b=b||{}).Get="GET",r.Post="POST",r.Put="PUT",r.Patch="PATCH",r.Delete="DELETE",r.Head="HEAD",r.Options="OPTIONS";function m(e,u,a,s){return new(a=a||Promise)(function(r,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,o)}i((s=s.apply(e,u||[])).next())})}function g(r,n){var o,i,u,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(u=2&t[0]?i.return:t[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,t[1])).done)return u;switch(i=0,(t=u?[2&t[0],u.value]:t)[0]){case 0:case 1:u=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(u=0<(u=a.trys).length&&u[u.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!u||t[1]>u[0]&&t[1]<u[3])){a.label=t[1];break}if(6===t[0]&&a.label<u[1]){a.label=u[1],u=t;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(t);break}u[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],i=0}finally{o=u=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var w=Object.freeze({__proto__:null,HaxanError:o,isHaxanError:u,HaxanTimeout:h,isHaxanTimeout:function(e){return u(e)&&!0===e.isTimeout},HaxanRejection:d,isHaxanRejection:function(e){return u(e)&&!0===e.isRejection},HaxanAbort:v,isHaxanAbort:function(e){return u(e)&&!0===e.isAbort},get ResponseType(){return y},get HTTPMethod(){return b}}),_=function(){return(_=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},k=(T.prototype.setProp=function(e,t){return this._opts[e]=t,this},T.prototype.rejectOn=function(e){return this.setProp("rejectOn",e)},T.prototype.url=function(e){return this.setProp("url",e)},T.prototype.type=function(e){return this.setProp("type",e)},T.prototype.method=function(e){return this.setProp("method",e)},T.prototype.get=function(){return this.method("GET")},T.prototype.head=function(){return this.method("HEAD")},T.prototype.options=function(){return this.method("OPTIONS")},T.prototype.post=function(e){return this.body(e).method("POST")},T.prototype.put=function(e){return this.body(e).method("PUT")},T.prototype.patch=function(e){return this.body(e).method("PATCH")},T.prototype.delete=function(){return this.method("DELETE")},T.prototype.body=function(e){return this.setProp("body",e)},T.prototype.header=function(e,t){return this._opts.headers[e]=t,this},T.prototype.param=function(e,t){return this._opts.query[e]=t,this},T.prototype.timeout=function(e){return this.setProp("timeout",e)},T.prototype.abort=function(e){return this.setProp("abortSignal",e)},T.prototype.normalizedBody=function(){var e=this._opts.body;return null===e?null:"string"==typeof e?e:JSON.stringify(e)},T.prototype.parseBody=function(r){return m(this,void 0,void 0,function(){var t;return g(this,function(e){switch(e.label){case 0:return(t=r.headers.get("content-type"))&&t.startsWith("application/json")?[4,r.json()]:[3,2];case 1:return[2,e.sent()];case 2:return[4,r.text()];case 3:return[2,e.sent()]}})})},T.prototype.getOptions=function(){return this._opts},T.prototype.send=function(){return this.execute()},T.prototype.execute=function(){return this.request()},T.prototype.request=function(){return m(this,void 0,void 0,function(){var o,i,u,a,s,c,l,f,p=this;return g(this,function(e){switch(e.label){case 0:return e.trys.push([0,9,,10]),o=void 0,i="undefined"!=typeof window&&"[object Window]"==={}.toString.call(window),o=i?fetch:re,u=Object.keys(this._opts.query).length?this._opts.url+"?"+(n=this._opts.query,Object.keys(n).map(function(e){return e+"="+String(n[e])}).join("&")):this._opts.url,[4,Promise.race([o(u,{method:this._opts.method,headers:_(_({"Content-Type":"application/json"},this._opts.headers),{"User-Agent":"Haxan 0.2.1"}),body:(t=this._opts.method,[b.Put,b.Post,b.Patch].includes(t.toUpperCase())?this.normalizedBody():void 0),signal:this._opts.abortSignal}),new Promise(function(e,t){return setTimeout(function(){return t(new h)},p._opts.timeout)})])];case 1:if(a=e.sent(),this._opts.rejectOn(a.status))throw new d(a);return t=a.headers,r={},t.forEach(function(e,t){r[t]=e}),s=r,this._opts.type!==y.Auto?[3,3]:(c={},[4,this.parseBody(a)]);case 2:return[2,(c.data=e.sent(),c.ok=a.ok,c.status=a.status,c.headers=s,c)];case 3:return this._opts.type!==y.Json?[3,5]:(l={},[4,a.json()]);case 4:return[2,(l.data=e.sent(),l.ok=a.ok,l.status=a.status,l.headers=s,l)];case 5:return this._opts.type!==y.Text?[3,7]:(f={},[4,a.text()]);case 6:return[2,(f.data=e.sent(),f.ok=a.ok,f.status=a.status,f.headers=s,f)];case 7:if(this._opts.type===y.Stream&&!i)return[2,{data:a.body,ok:a.ok,status:a.status,headers:s}];e.label=8;case 8:throw new Error("No valid response body parsing method found");case 9:if("AbortError"===(s=e.sent()).name)throw new v;throw s;case 10:return[2]}var r,t,n})})},T);function T(e,t){this._opts={url:"",headers:{},query:{},method:b.Get,body:void 0,type:y.Auto,rejectOn:function(){return!1},abortSignal:void 0,timeout:3e4},t&&Object.assign(this._opts,t),this.url(e)}function S(e,t){return new k(e,t)}o=function(){var e,t=S;for(e in w)t[e]=w[e];return t.HaxanFactory=k,t}(),e.HaxanFactory=k,e.default=o,Object.defineProperty(e,"__esModule",{value:!0})},"object"===t(e)?n(e):n((r="undefined"!=typeof globalThis?globalThis:r||self).Haxan={})}((Y={exports:{}},Y.exports)),Y.exports),oe=(X=ne)&&X.__esModule&&Object.prototype.hasOwnProperty.call(X,"default")?X.default:X,i=(ee=function(e,t){return(ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ee(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),ie=(te=Error,i(ue,te),ue);function ue(e){var t=te.call(this)||this;return t.isCorinthError=!0,t.res=e,t}var ae=function(e,u,a,s){return new(a=a||Promise)(function(r,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,o)}i((s=s.apply(e,u||[])).next())})},se=function(r,n){var o,i,u,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(u=2&t[0]?i.return:t[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,t[1])).done)return u;switch(i=0,(t=u?[2&t[0],u.value]:t)[0]){case 0:case 1:u=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(u=0<(u=a.trys).length&&u[u.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!u||t[1]>u[0]&&t[1]<u[3])){a.label=t[1];break}if(6===t[0]&&a.label<u[1]){a.label=u[1],u=t;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(t);break}u[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],i=0}finally{o=u=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},ce=(le.prototype.getName=function(){return this.name},le.prototype.uri=function(){return this.$root.getIp()+"/queue/"+this.name},le.prototype.getUrl=function(e){return this.uri()+e},le.prototype.ack=function(r){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,oe(this.getUrl("/"+r+"/ack")).method(oe.HTTPMethod.Post).send()];case 1:if((t=e.sent()).ok)return[2,!0];throw new ie(t)}})})},le.prototype.peek=function(){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,oe(this.getUrl("/peek")).send()];case 1:if((t=e.sent()).ok)return[2,t.data.result.item||null];throw new ie(t)}})})},le.prototype.dequeue=function(e){var t=void 0===e?{}:e,e=t.ack,n=void 0!==e&&e,t=t.amount,o=void 0===t?1:t;return ae(this,void 0,void 0,function(){var t,r=this;return se(this,function(e){switch(e.label){case 0:return t=oe(this.getUrl("/dequeue")).method(oe.HTTPMethod.Post).param("amount",o),n&&t.param("ack","true"),[4,t.send()];case 1:if((t=e.sent()).ok)return[2,t.data.result.items.map(function(t){return{message:t,ack:function(){return ae(r,void 0,void 0,function(){return se(this,function(e){return n?[2,!0]:[2,this.ack(t.id)]})})}}})];throw new ie(t)}})})},le.prototype.enqueueOne=function(t,r){return void 0===r&&(r=null),ae(this,void 0,void 0,function(){return se(this,function(e){return[2,this.enqueue([{item:t,deduplication:r}])]})})},le.prototype.enqueue=function(r){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,oe(this.getUrl("/enqueue")).post({messages:r}).send()];case 1:if((t=e.sent()).ok)return[2,t.data.result];throw new ie(t)}})})},le.prototype.stat=function(){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,oe(this.uri()).send()];case 1:if((t=e.sent()).ok)return[2,t.data.result.queue];throw new ie(t)}})})},le.prototype.size=function(){return ae(this,void 0,void 0,function(){return se(this,function(e){switch(e.label){case 0:return[4,this.stat()];case 1:return[2,e.sent().size]}})})},le.prototype.purge=function(){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,oe(this.getUrl("/purge")).delete().send()];case 1:if((t=e.sent()).ok)return[2,!0];throw new ie(t)}})})},le.prototype.edit=function(t){return ae(this,void 0,void 0,function(){return se(this,function(e){return[2,this.update(t)]})})},le.prototype.update=function(r){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,oe(this.uri()).patch(r).send()];case 1:if((t=e.sent()).ok)return[2,!0];throw new ie(t)}})})},le.prototype.exists=function(){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.stat()];case 1:return e.sent(),[2,!0];case 2:if((t=e.sent()).isCorinthError&&404===t.res.status)return[2,!1];throw t;case 3:return[2]}})})},le.prototype.delete=function(){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return[4,oe(this.uri()).delete().send()];case 1:if((t=e.sent()).ok)return[2,!0];throw new ie(t)}})})},le.prototype.create=function(r){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return t=oe(this.uri()).method(oe.HTTPMethod.Put),void 0!==(null==r?void 0:r.dead_letter_queue)&&t.param("dead_letter_queue_name",r.dead_letter_queue.getName()),void 0!==(null==r?void 0:r.dead_letter_queue_threshold)&&t.param("dead_letter_queue_threshold",String(r.dead_letter_queue_threshold)),void 0!==(null==r?void 0:r.deduplication_time)&&t.param("deduplication_time",String(r.deduplication_time)),void 0!==(null==r?void 0:r.max_length)&&t.param("max_length",String(r.max_length)),void 0!==(null==r?void 0:r.persistent)&&t.param("persistent",String(r.persistent)),void 0!==(null==r?void 0:r.requeue_time)&&t.param("requeue_time",String(r.requeue_time)),[4,t.send()];case 1:if((t=e.sent()).ok)return[2,!0];throw new ie(t)}})})},le.prototype.ensure=function(r){return ae(this,void 0,void 0,function(){var t;return se(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.create(r)];case 1:return[2,e.sent()];case 2:if((t=e.sent()).isCorinthError&&409===t.res.status)return[2,!0];throw t;case 3:return[2]}})})},le);function le(e,t){this.$root=e,this.name=t}var fe=function(e,u,a,s){return new(a=a||Promise)(function(r,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(n,o)}i((s=s.apply(e,u||[])).next())})},pe=function(r,n){var o,i,u,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(u=2&t[0]?i.return:t[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,t[1])).done)return u;switch(i=0,(t=u?[2&t[0],u.value]:t)[0]){case 0:case 1:u=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(u=0<(u=a.trys).length&&u[u.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!u||t[1]>u[0]&&t[1]<u[3])){a.label=t[1];break}if(6===t[0]&&a.label<u[1]){a.label=u[1],u=t;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(t);break}u[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],i=0}finally{o=u=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},n=(he.prototype.getIp=function(){return this.ip},he.prototype.version=function(){return fe(this,void 0,void 0,function(){return pe(this,function(e){switch(e.label){case 0:return[4,this.stat()];case 1:return[2,e.sent().version]}})})},he.prototype.stat=function(){return fe(this,void 0,void 0,function(){var t;return pe(this,function(e){switch(e.label){case 0:return[4,oe(this.ip).send()];case 1:if((t=e.sent()).ok)return[2,t.data.result.info];throw new ie(t)}})})},he.prototype.listQueues=function(){return fe(this,void 0,void 0,function(){var t;return pe(this,function(e){switch(e.label){case 0:return[4,oe(this.ip+"/queues").send()];case 1:if((t=e.sent()).ok)return[2,t.data.result.queues.items];throw new ie(t)}})})},he.prototype.queueExists=function(t){return fe(this,void 0,void 0,function(){return pe(this,function(e){return[2,new ce(this,t).exists()]})})},he.prototype.defineQueue=function(e){return new ce(this,e)},he);function he(e){this.ip=e}e.MessageState=void 0,(i=e.MessageState||(e.MessageState={}))[i.Pending=0]="Pending",i[i.Requeued=1]="Requeued",e.Corinth=n,e.CorinthError=ie,e.Queue=ce,Object.defineProperty(e,"__esModule",{value:!0})});
